-- Ranking customers based on number of orders they have completed

SELECT
    customerkey,
    orderdate,
    (quantity * netprice * exchangerate) AS net_revenue,
    COUNT(*) OVER(
      PARTITION BY customerkey
      ORDER BY orderdate
    ) AS running_order_count,
    AVG((quantity * netprice * exchangerate)) OVER(
      PARTITION BY customerkey
      ORDER BY orderdate
    ) AS running_avg_revenue
FROM sales


/*
index,customerkey,orderdate,net_revenue,running_order_count,running_avg_revenue
0,15,2021-03-08,2217.4064388,1,2217.4064388
1,180,2018-07-28,525.3105168000001,1,525.3105168000001
2,180,2023-08-28,71.35685799999999,3,836.7384189333333
3,180,2023-08-28,1913.5478819999996,3,836.7384189333333
4,185,2019-06-01,1395.5234436,1,1395.5234436
5,243,2016-05-19,287.66755741500003,1,287.66755741500003
6,387,2018-12-21,97.05210767999999,4,592.6351857976
7,387,2018-12-21,45.62235215999999,4,592.6351857976
8,387,2018-12-21,619.7706513503999,4,592.6351857976
9,387,2018-12-21,1608.095632,4,592.6351857976
10,387,2021-10-30,1265.55637824,5,727.21942428608
11,387,2023-11-16,180.34887329999998,9,517.3152850173778
12,387,2023-11-16,446.43712200000004,9,517.3152850173778
13,387,2023-11-16,30.513529926,9,517.3152850173778
14,387,2023-11-16,362.4409185,9,517.3152850173778
15,406,2021-11-06,1430.7270094799999,2,1096.7077059911999
16,406,2021-11-06,762.6884025024,2,1096.7077059911999
17,545,2023-07-01,1344.61701,6,591.9121788599999
18,545,2023-07-01,66.40084,6,591.9121788599999
19,545,2023-07-01,266.207004,6,591.9121788599999
20,545,2023-07-01,318.670911328,6,591.9121788599999
21,545,2023-07-01,1475.90958,6,591.9121788599999
22,545,2023-07-01,79.667727832,6,591.9121788599999
23,649,2022-05-16,599.4552020366,4,578.4946041066501
24,649,2022-05-16,260.02539486,4,578.4946041066501
25,649,2022-05-16,1083.96358224,4,578.4946041066501
26,649,2022-05-16,370.53423729,4,578.4946041066501
27,649,2023-05-22,569.99916864,6,677.1812719164333
28,649,2023-05-22,1179.110046432,6,677.1812719164333
29,668,2019-10-01,162.29184400000003,1,162.29184400000003
30,688,2023-09-13,2473.7803200000003,5,3381.8081857428006
31,688,2023-09-13,1337.7154487999999,5,3381.8081857428006
32,688,2023-09-13,85.24203451400001,5,3381.8081857428006
33,688,2023-09-13,12106.53096,5,3381.8081857428006
34,688,2023-09-13,905.7721654000001,5,3381.8081857428006
35,864,2019-01-22,848.177568,1,848.177568
36,864,2020-01-15,39.93821832,2,444.05789316
37,864,2022-07-09,10479.070727999999,3,3789.06217144
38,957,2018-11-08,567.123479,1,567.123479
39,957,2022-02-24,4213.514214,2,2390.3188465
40,957,2022-09-26,734.7990232,3,1838.4789054
41,963,2023-12-21,46.98972515999999,1,46.98972515999999
42,1045,2022-06-25,148.65508799999998,2,307.2011074524
43,1045,2022-06-25,465.7471269048,2,307.2011074524
44,1045,2023-03-02,4098.161528,4,1191.5201227861999
45,1045,2023-03-02,53.51674824,4,1191.5201227861999
46,1092,2019-11-07,276.73032217791996,1,276.73032217791996
47,1092,2024-02-14,396.7643519999999,2,336.74733708895997
48,1194,2019-05-20,8134.823759999999,4,3320.5094518339993
49,1194,2019-05-20,4335.392747999999,4,3320.5094518339993
50,1194,2019-05-20,136.30310599999999,4,3320.5094518339993
51,1194,2019-05-20,675.5181933360001,4,3320.5094518339993
52,1194,2023-06-21,190.77810000000002,5,2694.5631814671992
53,1358,2023-03-31,347.05112,2,212.75684688700002
54,1358,2023-03-31,78.462573774,2,212.75684688700002
55,1371,2016-03-15,539.9380918080001,5,430.20597722760004
56,1371,2016-03-15,281.21775615,5,430.20597722760004
57,1371,2016-03-15,257.59763410500005,5,430.20597722760004
58,1371,2016-03-15,647.5631673600001,5,430.20597722760004
59,1371,2016-03-15,424.713236715,5,430.20597722760004
60,1381,2020-02-03,4296.6055934999995,1,4296.6055934999995
61,1401,2024-03-11,405.85116,1,405.85116
62,1509,2016-09-06,1247.6178063999998,1,1247.6178063999998
63,1539,2021-06-12,452.6383722,3,738.9126196272
64,1539,2021-06-12,1160.51169,3,738.9126196272
65,1539,2021-06-12,603.5877966816,3,738.9126196272
66,1583,2022-03-03,738.06359706,1,738.06359706
67,1802,2022-09-28,372.0463815,1,372.0463815
68,1802,2023-06-17,4073.57873824,3,1763.5962859133333
69,1802,2023-06-17,845.163738,3,1763.5962859133333
70,1806,2022-08-13,111.839116158,4,202.1446084185
71,1806,2022-08-13,468.83279519999996,4,202.1446084185
72,1806,2022-08-13,85.9611357,4,202.1446084185
73,1806,2022-08-13,141.945386616,4,202.1446084185
74,1807,2022-01-24,262.74830399999996,1,262.74830399999996
75,1898,2023-12-18,383.40864,2,303.16032
76,1898,2023-12-18,222.912,2,303.16032
77,2185,2021-06-17,1138.4334972,7,1356.0949974457142
78,2185,2021-06-17,33.46725888,7,1356.0949974457142
79,2185,2021-06-17,8.17665984,7,1356.0949974457142
80,2185,2021-06-17,581.0287999999999,7,1356.0949974457142
81,2185,2021-06-17,4403.5314413999995,7,1356.0949974457142
82,2185,2021-06-17,2923.6312799999996,7,1356.0949974457142
83,2185,2021-06-17,404.39604479999997,7,1356.0949974457142
84,2267,2018-12-27,593.2008000000001,1,593.2008000000001
85,2267,2019-02-19,311.69574655872003,2,452.44827327936
86,2268,2023-02-07,793.9122047999999,3,414.51281229999995
87,2268,2023-02-07,33.4555806,3,414.51281229999995
88,2268,2023-02-07,416.1706515,3,414.51281229999995
89,2283,2023-02-04,70.7993152,1,70.7993152
90,2439,2019-05-28,40.444212897,1,40.444212897
91,2523,2018-05-31,4181.11317,2,2140.076649048
92,2523,2018-05-31,99.040128096,2,2140.076649048
93,2523,2018-06-18,714.2038046063999,3,1664.7857009008
94,2523,2020-02-06,1484.5152960000003,5,1397.0980350916802
95,2523,2020-02-06,506.61777675600007,5,1397.0980350916802
96,2599,2021-06-04,328.2313484736,4,1413.14882385285
97,2599,2021-06-04,3236.3099640000005,4,1413.14882385285
98,2599,2021-06-04,1095.5952,4,1413.14882385285
99,2599,2021-06-04,992.4587829378002,4,1413.14882385285
*/